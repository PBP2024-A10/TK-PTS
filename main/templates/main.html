{% extends 'base.html' %}
{% load static %}
{% block meta %}
<title>Homepage - Daftar Makanan</title>
{% endblock meta %}

{% block content %}
<div class="bg-cover bg-center bg-[#3d200a] text-[#e8dcd4]" style="background-image: url('{% static 'image/image 3.png' %}')">
{% include 'navbar.html' %}
<div class="container mx-auto p-8 mt-20">
  <div class="flex items-center justify-between">
    <h1 class="text-4xl font-extrabold text-[#e8dcd4]">Daftar Restoran</h1>
  </div>
  

<div id="default-carousel" class="relative w-full" data-carousel="slide">
    <!-- Carousel wrapper -->
    <div class="relative h-56 overflow-hidden rounded-lg md:h-96">
         <!-- Item 1 -->
        <div class="hidden duration-700 ease-in-out" data-carousel-item>
            <img src="https://cdn.ngopibareng.id/uploads/2021/2021-10-28/12-makanan-khas-bali-yang-jadi-incaran-wisatawan--02" class="absolute block w-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="...">
        </div>
        <!-- Item 2 -->
        <div class="hidden duration-700 ease-in-out" data-carousel-item>
            <img src="https://awsimages.detik.net.id/community/media/visual/2022/11/20/rijsttafel-indonesia-2.jpeg?w=1200" class="absolute block w-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="...">
        </div>
        <!-- Item 3 -->
        <div class="hidden duration-700 ease-in-out" data-carousel-item>
            <img src="https://s3-ap-southeast-1.amazonaws.com/blog-assets.segari.id/2022/10/Ayam-Betutu---Istock.jpg" class="absolute block w-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="...">
        </div>
        
    </div>
    <!-- Slider indicators -->
    <div class="absolute z-10 flex -translate-x-1/2 bottom-2 left-1/2 space-x-3 rtl:space-x-reverse">
        <button type="button" class="w-3 h-3 rounded-full" aria-current="true" aria-label="Slide 1" data-carousel-slide-to="0"></button>
        <button type="button" class="w-3 h-3 rounded-full" aria-current="false" aria-label="Slide 2" data-carousel-slide-to="1"></button>
    </div>

    <!-- Slider controls -->
    <div class="flex items-center justify-center mt-10 mb-4 relative z-20">
        <input type="text" id="restaurant-search" class="border border-[#cbbcb5] rounded-lg px-4 py-2 w-2/3 text-[#3d200a] bg-[#e8dcd4] placeholder-[#3d200a]" placeholder="Cari restoran...">
    <div id="search-results"></div>

    </div>

      
    <button type="button" class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-prev>
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
            <svg class="w-4 h-4 text-white dark:text-gray-800 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
            </svg>
            <span class="sr-only">Previous</span>
        </span>
    </button>
    <button type="button" class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-next>
        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
            <svg class="w-4 h-4 text-white dark:text-gray-800 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
            </svg>
            <span class="sr-only">Next</span>
        </span>
    </button>
</div>

<!-- Updated Button Color Palette -->
<div class="flex items-center justify-center py-4 md:py-8 flex-wrap">
    <button type="button" class="text-[#e8dcd4] bg-[#3d200a] hover:bg-[#654a2d] focus:ring-4 focus:outline-none focus:ring-[#927155] rounded-full text-base font-medium px-5 py-2.5 text-center me-3 mb-3">All categories</button>
</div>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e8dcd4;
            color: #3d200a;
            margin: 0;
        }

        .add-restaurant-button {
            display: flex;
            justify-content: flex-end; /* Mengatur posisi tombol di sebelah kanan */
            margin-top: 20px; /* Meningkatkan jarak atas tombol */
            margin-bottom: 0px; /* Jarak bawah tombol */
            width: 80%; /* Lebar tombol agar sama dengan judul */
            margin-left: auto; /* Memastikan tombol berada di tengah */
            margin-right: auto; /* Memastikan tombol berada di tengah */
        }


        .add-restaurant-button a {
            background-color: #927155; /* Warna latar belakang tombol */
            color: #fff; /* Warna teks tombol */
            padding: 10px 20px; /* Padding tombol */
            text-decoration: none; /* Menghapus garis bawah */
            border-radius: 5px; /* Sudut membulat pada tombol */
            font-weight: bold; /* Menebalkan teks */
        }

        .add-restaurant-button a:hover {
            background-color: #e2c7b3; /* Warna latar belakang saat hover */
            color: #3d200a; /* Warna teks saat hover */
        }

        .restaurant-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;  /* Ruang antar kartu */
            justify-content: center;
            margin-top: 20px; /* Jarak tambahan antara judul dan kartu */
        }

        .card {
            border: 2px solid #cbbcb5;
            border-radius: 8px;
            padding: 10px;
            width: 200px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            background-color: #fff;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
        }

        .card h2 {
            color: #927155;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .card p {
            margin: 4px 0;
            font-size: 14px;
        }

        .show-more {
            margin-top: auto;
            font-weight: bold;
            color: #5d4d3b;
            text-decoration: none;
            align-self: flex-end;
        }

        .show-more:hover {
            text-decoration: underline;
        }

        .delete-button {
            margin-top: 10px;
            font-weight: bold;
            color: red;
            text-decoration: none;
            align-self: flex-end;
        }

        .delete-button:hover {
            text-decoration: underline;
        }

        .pagination {
            margin-top: 20px;
            text-align: center;
        }

        .pagination a {
            margin: 0 10px;
            text-decoration: none;
            color: #654a2d;
            font-weight: bold;
        }

        .pagination a:hover {
            text-decoration: underline;
        }

        .no-data {
            text-align: center;
            color: #654a2d;
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
    <script>
        function confirmDelete() {
            return confirm('Apakah Anda yakin ingin menghapus restoran ini?');
        }
    </script>
</head>
<body>
    <!-- Tombol "Add Restaurant" di bawah judul -->
    {% if user.is_staff %}
    <div class="add-restaurant-button">
      <a href="{% url 'cards_makanan:add_restaurant' %}">Add Restaurant</a>
    </div>
    {% endif %}
    
    <div class="restaurant-cards">
        {% if page_obj %}
            {% for restaurant in page_obj %}
                <div class="card">
                    <img src="https://picsum.photos/200/120?random={{ forloop.counter }}" alt="Foto {{ restaurant.name }}">
                    <h2>{{ restaurant.name }}</h2>
                    <p>{{ restaurant.description }}</p>
                    <a href="{% url 'cards_makanan:show_menu' restaurant.id %}" class="show-more">Show more &rarr;</a>
                    {% if user.is_staff %}
                    <a href="{% url 'cards_makanan:delete_restaurant' restaurant.id %}" class="delete-button" onclick="return confirm('Are you sure you want to delete this restaurant?');">Hapus</a>
                    {% endif %}
                </div>
            {% endfor %}

            <!-- Tambahkan link untuk navigasi halaman -->
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}">Sebelumnya</a>
                {% endif %}
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">Berikutnya</a>
                {% endif %}
            </div>
        {% else %}
            <p class="no-data">Belum ada data restoran.</p>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchBar = document.getElementById('restaurant-search');
        
            // Function to fetch CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        
            const csrfToken = getCookie('csrftoken');
        
            searchBar.addEventListener('input', function() {
                const query = this.value;
        
                fetch('/filter_restaurants/?q=' + query, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    const restaurantContainer = document.querySelector('.restaurant-cards');
                    restaurantContainer.innerHTML = ''; // Clear current restaurant cards
        
                    if (data.restaurants.length > 0) {
                        data.restaurants.forEach(restaurant => {
                            const card = document.createElement('div');
                            card.classList.add('card');
        
                            // Create restaurant card elements
                            card.innerHTML = `
                                <img src="https://picsum.photos/200/120?random=${restaurant.id}" alt="Foto ${restaurant.name}">
                                <h2>${restaurant.name}</h2>
                                <p>${restaurant.description}</p>
                                <a href="/makanan/menu/${restaurant.id}" class="show-more">Show more &rarr;</a>
                            `;
                            restaurantContainer.appendChild(card);
                        });
                    } else {
                        restaurantContainer.innerHTML = '<p class="no-data">No restaurants found.</p>';
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
            });
        });
        </script>
        
    
    
    
</body>
</html>

</div>
{% endblock content %}